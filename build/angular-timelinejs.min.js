/*! angular-timelinejs 2014-08-25 */
"use strict";angular.module("pippTimelineDirectives",[]).directive("pippTimelineJS",function(a,b){return{template:'<div id="pipp-timeline"></div>',restrict:"E",scope:{source:"=",width:"@",height:"@",startZoomAdjust:"@",startAtEnd:"@",startAtSlide:"@",hashBookmark:"@",font:"@",lang:"@",thumbnailUrl:"@",state:"=",tagClicked:"=",debug:"@"},link:function(a,c){var d,e=void 0===a.width?"960":a.width,f=void 0===a.height?"540":a.height,g={source:a.source};a.type&&(g.type=a.type),a.embedId&&(g.embed_id=a.embedId),a.embed&&(g.embed=a.embed),"true"===a.startAtEnd&&(g.start_at_end=!0),g.start_at_end=!1,a.startZoomAdjust&&(g.start_zoom_adjust=a.startZoomAdjust),a.startAtSlide&&(g.start_at_slide=a.startAtSlide),g.hash_bookmark="true"===a.hashBookmark?!0:!1,a.font&&(g.font=a.font),a.thumbnailUrl&&(g.thumbnail_url=a.thumbnailUrl),VMM.debug="true"===a.debug?!0:!1,console.log("Timeline Configuration: ",g),a.$watch("state.modal_open",function(a){d&&(console.log("Modal open for editing: ",a),d.set_config_item("modal_open",a))});var h=function(b){b&&!d?(console.log("Initializing timeline with: ",g),g.source=b,d=new VMM.Timeline("pipp-timeline",e,f),d.init(g),console.log("VMM.Timeline object: ",d)):b&&d&&(console.log("Reloading timeline"),a.state.index?d.reload(b,a.state.index):d.reload(b))};a.$watch("source",function(a){return a?(a=l(a,k),void h(a)):void console.log("Waiting for source data")}),h(a.source),a.$watch("state.index",function(a){console.log("Detected state change: ",a),d&&d.set_slide(a)}),console.log("Listening to events");var i=function(c){return console.log("Timeline navigation event: ",c),b(function(){a.state.index=d.get_config().current_slide,console.log("Index updated: ",a.state.index)})};c.on("click",".nav-next",function(a){i(a)}),c.on("click",".nav-previous",function(a){i(a)}),c.on("click",".marker",function(a){i(a)}),c.on("click",".tag",function(b){a.$apply(function(){a.tagClicked(b.currentTarget.innerText)})});var j=angular.element(document.body);j.on("keydown",function(a){var b={33:"PgUp",34:"PgDn",37:"Left",39:"Right",36:"Home",35:"End"},c=Object.getOwnPropertyNames(b);-1!=c.indexOf(a.keyCode+"")&&i(a)});var k=function(a){var b=a.text.split("|ENDTAGS|"),c="";if(""!=b[0]){var d=b[0].split(","),e='<ul class="tag_collection">',f="",g="</ul>";d.forEach(function(a){"confirm"!==a&&"surprise"!==a&&"challenge"!==a&&(f=f+'<li class="tag" ng-click="addTag(\''+a+"')\">"+a+"</li>")}),c=e+f+g}return a.text=c+b[1],a},l=function(a,b){var c=a.timeline.date;return a.timeline.date=c.map(b),console.log("Source with formatted tags: ",a),a}}}});